<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bobby Fatemi">
<meta name="dcterms.date" content="2023-06-12">
<meta name="description" content="This post describes a pricing model that will identify the optimal price (one that maximizes demand) for various Kiva edible products; in addition, I summarize the price-point and discount level that maximize product sell-through for these Kiva products.">

<title>Blog - Optimal Price of Kiva Products</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon_io/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/ninja-quant-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../pages/about/index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pages/analytics/index.html" rel="" target="">
 <span class="menu-text">Analytics</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/r-data-science" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/bobbyfatemi" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://us21.list-manage.com/contact-form?u=9a91f0c5718cbb77d8b252807&amp;form_id=0d3c34c402b50424ea117b80c34a2aa4" rel="" target="">
 <span class="menu-text">Contact</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Optimal Price of Kiva Products</h1>
                  <div>
        <div class="description">
          This post describes a pricing model that will identify the optimal price (one that maximizes demand) for various Kiva edible products; in addition, I summarize the price-point and discount level that maximize product sell-through for these Kiva products.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">insights</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Bobby Fatemi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 12, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="summary" class="level1">
<h1>Summary</h1>
<p>After modeling for the optimal price, one that maximizes demand level, and after normalizing demand across various sized organizations, <strong>I find that Kiva Products on average are about 8% overpriced when comparing the average historical price items have been sold across all time, vs.&nbsp;the price that successful retailers are selling these products to acheive the maximum product sell-through possible at their retail locations.</strong></p>
<p>To summarize the findings by product:</p>
<ul>
<li><p>To achieve maximum demand for <u><strong>Camino Gummies</strong></u>, products are selling at an average discount of about 21% with a final out the door price of roughly $18.</p></li>
<li><p>To achieve maximum demand for <u><strong>Kiva Chocolate Bars</strong></u>, products are selling at an average discount of about 18% with a final out the door price of roughly $20.5.</p></li>
<li><p>To achieve maximum demand for <u><strong>Kiva Terra Bites</strong></u>, products are selling at an average discount of about 17% with a final out the door price of roughly $21.</p></li>
</ul>
<p>For a breakdown of the methodology and technical analysis results, see below.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>Kiva is a very important brand in the cannabis market. Kiva brand offers many types of edible products. Notably, Gummies, Chocolate Bars, Chocolate covered bites (espresso beans, blueberries), and various flavors of Mints.</p>
<p>Kiva products make up roughly 9% of the edibles market as shown in our data. Of all the Kiva branded products, here is the share of each (within Brand Kiva products being sold):</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Sales Since 2019</th>
<th style="text-align: right;">Units Sold Since 2019</th>
<th style="text-align: left;">Average Unit Price</th>
<th style="text-align: left;">Average Discount</th>
<th style="text-align: left;">Share of all Kiva Sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Kiva Camino Gummies</td>
<td style="text-align: left;">$16,512,816</td>
<td style="text-align: right;">841,581</td>
<td style="text-align: left;">$19.9</td>
<td style="text-align: left;">13%</td>
<td style="text-align: left;">62.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kiva Chocolate Bars</td>
<td style="text-align: left;">$4,035,526</td>
<td style="text-align: right;">189,080</td>
<td style="text-align: left;">$21.5</td>
<td style="text-align: left;">15%</td>
<td style="text-align: left;">14.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kiva Terra Bites</td>
<td style="text-align: left;">$3,572,374</td>
<td style="text-align: right;">157,131</td>
<td style="text-align: left;">$23.0</td>
<td style="text-align: left;">12%</td>
<td style="text-align: left;">11.7%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kiva Mints</td>
<td style="text-align: left;">$1,798,838</td>
<td style="text-align: right;">101,586</td>
<td style="text-align: left;">$17.8</td>
<td style="text-align: left;">9%</td>
<td style="text-align: left;">7.5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kiva Other Products</td>
<td style="text-align: left;">$1,232,026</td>
<td style="text-align: right;">58,129</td>
<td style="text-align: left;">$21.4</td>
<td style="text-align: left;">11%</td>
<td style="text-align: left;">4.3%</td>
</tr>
</tbody>
</table>
</section>
<section id="objective" class="level1">
<h1>Objective</h1>
<p>The objective of this analysis is to identify the optimal price point of the top 3 Kiva products offered on the market. The aim is to develop a price-demand model based on the <strong>observed sell-through rate</strong> (i.e. Demand) of each product and changes in the price. The model will identity the correlation between sales and demand</p>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<ol type="1">
<li><p>The observed sell-through rate (also referred to as Sales Velocity) is first estimated as Units Sold Per Week and calculated at the org and facility level.</p></li>
<li><p>Once I have this weekly metric for every org and facility (with data going back to 2019), I calculate the average weekly price of each of the Kiva product segments in focus (Gummies, Chocolate Bars, and Terra Bites), as well as the weekly average percentage discount rate offered to retail customers.</p></li>
<li><p>Next, since each org offers these products to a varying sized customer base, the value of Unit Sales per week isn’t an appropriate relative comparison across orgs; therefore in order to understand demand, I must normalize Sell-Through velocity.</p></li>
<li><p>The normalized velocity is then called ‘Demand’ and expressed as a percentage between 0 and 100, where 100 represents the observed maximum demand level for any given org.</p></li>
<li><p>After retrieving the normalized weekly demand for every org, I then model the correlation between price changes and changes in percentage demand. The results give us an indication of the price level which maximizes demand across all orgs.</p></li>
<li><p>Furthermore, the demand level can be grouped to give us summary statistics that offer an indication of the discounting performed to reach such a price.</p></li>
</ol>
<section id="note-about-the-model" class="level2">
<h2 class="anchored" data-anchor-id="note-about-the-model">Note about the Model:</h2>
<p>Demand is expressed as a function <span class="math inline">\(Demand = F(P)\)</span>; where <span class="math inline">\(F(P)\)</span> (being a function of Price) is estimated with the following equation using a Generalized Additive Model (GAM): <span class="math inline">\(F(P) = B_2(ln(P) * ln(P + 1)) + B_1\)</span>. This Model gives us the expected shape of a price/demand relationship and the data supports such a fit as can be seen in the results section below.</p>
<blockquote class="blockquote">
<p>For this model, the term <span class="math inline">\(B_2\)</span> can be considered the price elasticity of demand depending on the product type (Chocolate Bar, Camino Gummy, or Terra Bites) and <span class="math inline">\(B_1\)</span> is considered the minimum level of demand for such a product. The accuracy metrics for this model are the model <span class="math inline">\(R^2\)</span>, the model <span class="math inline">\(p-value\)</span> as well as the model <span class="math inline">\(F-statistic\)</span>. The accuracy for this model ranges from 80% (Kiva Terra Bites) to 90% (Kiva Chocolate Bars) while the confidence interval around the model’s fit is 95%.</p>
</blockquote>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>The model fit on the historical data is shown in the figures below, however the following table highlights the summary of the output (e.g. optimal price that maximizes demand) that is extracted from the models for each product.</p>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 35%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Product</th>
<th>Optimal Price (Model Output)</th>
<th>Current Historical Average Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Kiva Camino Gummies</td>
<td>$17.9</td>
<td>$19.9</td>
</tr>
<tr class="even">
<td>Kiva Chocolate Bars</td>
<td>$20.5</td>
<td>$21.5</td>
</tr>
<tr class="odd">
<td>Kiva Terra Bites</td>
<td>$20.9</td>
<td>$23.0</td>
</tr>
</tbody>
</table>
<section id="kiva-camino-gummies" class="level2">
<h2 class="anchored" data-anchor-id="kiva-camino-gummies">Kiva Camino Gummies</h2>
<blockquote class="blockquote">
<p><strong>In summary, to achieve maximum demand for Camino Gummies, products are selling at an average discount of about 21% with a final out the door average price of roughly $18.</strong></p>
</blockquote>
<p>The following plot describes the model being fit on normalized demand data for all orgs. The x-axis describes the percentage demand which is simply the normalized product sell-through velocity, while the y-axis is the average unit prices. This plot shows the correlation between changes in price and changes in demand as observed in the data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Price-Kiva-Camino-Gummies.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Optimal Pricing of Kiva Camino Gummies</figcaption>
</figure>
</div>
<p>The plot below summarizes the average discount level offered seen at various levels of demand while also highlighting the average price of units sold in each group.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Disc-Demand-Camino-Gummies-Barplot.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Discount Pricing and Demand Summary for Kiva Camino Gummies</figcaption>
</figure>
</div>
</section>
<section id="kiva-chocolate-bars-100mg" class="level2">
<h2 class="anchored" data-anchor-id="kiva-chocolate-bars-100mg">Kiva Chocolate Bars (100mg)</h2>
<blockquote class="blockquote">
<p><strong>In summary, to achieve maximum demand for Kiva Chocolate Bars, products are selling at an average discount of about 18% with a final out the door average price of roughly $21.</strong></p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Price-Kiva-Chocolate-Bars.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Optimal Pricing of Kiva Chocolate Bars</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Disc-Demand-Chocolate-Bars-Barplot.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Discount Demand Summary for Kiva Chocolate Bars</figcaption>
</figure>
</div>
</section>
<section id="kiva-terra-bites" class="level2">
<h2 class="anchored" data-anchor-id="kiva-terra-bites">Kiva Terra Bites</h2>
<blockquote class="blockquote">
<p><strong>In summary, to achieve maximum demand for Kiva Terra Bites, products are selling at an average discount of about 17% with a final out the door average price of roughly $20.5.</strong></p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Price-Kiva-Terra-Bites.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Optimal Pricing of Kiva Terra Bites</figcaption>
</figure>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>